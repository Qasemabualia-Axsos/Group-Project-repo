{% extends "base.html" %}
{% load static %}

{% block content %}
<!-- Hero Section -->
<section class="hero d-flex align-items-center justify-content-center text-center text-light">
  <div>
    <h1 class="fw-bold display-4">Discover the Best Movies & Stars</h1>
    <p class="lead">Explore Ratings, Reviews & Your Favorite Celebrities</p>
  </div>
</section>

<div id="moviesCarousel"  class="carousel slide" data-bs-ride="carousel">
  <div class="carousel-inner">
    {% for movie in Movies %}
    <div class="carousel-item {% if forloop.first %}active{% endif %}">
      <a href="{% url 'movies:view_movie' movie.id%}"><img id="top" src="{{ movie.cover_img.url }}"
          class="d-block w-100" alt="{{ movie.title }}" style="max-height:600px; object-fit:cover; "></a>
      <div class="carousel-caption d-none d-md-block bg-dark bg-opacity-50 p-3 rounded">
        <a style="text-decoration: none; color: white;" href="{% url 'movies:view_movie' movie.id%}">
          <h5>{{ movie.title }}</h5>
        </a>
        <small style="color: white;">Release Date: {{ movie.release_date }}</small>
      </div>
    </div>
    {% endfor %}
  </div>

  <!-- Controls -->
  <button class="carousel-control-prev" type="button" data-bs-target="#moviesCarousel" data-bs-slide="prev">
    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Previous</span>
  </button>
  <button class="carousel-control-next" type="button" data-bs-target="#moviesCarousel" data-bs-slide="next">
    <span class="carousel-control-next-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Next</span>
  </button>

  <!-- Indicators -->
  <div class="carousel-indicators mt-3">
    {% for movie in Movies %}
    <button type="button" data-bs-target="#moviesCarousel" data-bs-slide-to="{{ forloop.counter0 }}"
      class="{% if forloop.first %}active{% endif %}" aria-current="{% if forloop.first %}true{% endif %}"
      aria-label="Slide {{ forloop.counter }}"></button>
    {% endfor %}
  </div>
</div>

<!-- Trending Movies -->
<div class="movie-carousel mt-5">
  <h3 style="text-align: center;" class="mb-3 text-warning">Top Movies</h3>
  <div class="d-flex overflow-auto pb-3">
    {% for movie in top_movies %}
    <div class="me-3 text-center trending-card">
      <a href="{% url 'movies:view_movie' movie.id %}">
        <img id="top" src="{{ movie.cover_img.url }}" class="d-block w-100" alt="{{ movie.title }}"
          style="max-height:500px; object-fit:cover;">
      </a>
      <p class="mt-2">{{ movie.title }}</p>
      <div class="rating">
        {% for i in "12345" %}
        {% if forloop.counter <= movie.avg_rating|default:0|floatformat:0 %} <i class="bi bi-star-fill"></i>
          {% elif forloop.counter <= movie.avg_rating|default:0|floatformat:1 %} <i class="bi bi-star-half"></i>
            {% else %}
            <i class="bi bi-star"></i>
            {% endif %}
            {% endfor %}
            <span>{{ movie.avg_rating|default:"0"|floatformat:1 }}/5</span>
      </div>
    </div>
    {% endfor %}
  </div>
</div>

<!-- Latest Reviews -->
<div class="latest-reviews mt-5">
  <h3 style="text-align: center;" class="mb-3 text-warning">Latest Reviews</h3>
  <div class="list-group">
    {% for review in latest_reviews %}
    <a href="{% url 'movies:view_movie' review.movie.id %}"
      class="list-group-item list-group-item-action bg-dark text-light">
      <strong>{{ review.movie.title }}</strong> - "{{ review.comment|truncatewords:10 }}"
    </a>
    {% empty %}
    <p class="text-light">No reviews yet.</p>
    {% endfor %}
  </div>
</div>

{% endblock %}